# Next.js Caching Strategies - Developer Guide

**A comprehensive guide to modern caching patterns in Next.js 14+**

This project demonstrates advanced caching strategies that every Next.js developer should master. Focus on **ISR**, **Use Cache**, and **Partial Pre-rendering (PPR)** for optimal performance.

## ‚öôÔ∏è **Next.js Configuration Requirements**

Before implementing these caching strategies, ensure your `next.config.js` is properly configured:

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    // Required for 'use cache' directive and PPR
    cacheComponents: true,
  },

  // Optional: Disable development indicators for cleaner UI
  devIndicators: {
    buildActivity: false,
    buildActivityPosition: "bottom-right",
  },

  // Required for external images (if using remote images)
  images: {
    remotePatterns: [
      {
        protocol: "https",
        hostname: "fakestoreapi.com",
      },
      {
        protocol: "https",
        hostname: "via.placeholder.com",
      },
    ],
  },
};

module.exports = nextConfig;
```

---

## üéØ Why This Guide Matters

Modern web applications demand both **speed** and **freshness**. This guide shows you how to:

- ‚ö° Deliver instant page loads with static generation
- üîÑ Keep content fresh with smart revalidation
- üé™ Stream dynamic content while serving static shells
- üíæ Cache expensive operations efficiently

## üöÄ Key Strategies (Start Here)

### 1. Static Site Generation (SSG) ‚≠ê

**Pre-rendered at build time - fastest performance**

```typescript
// No special configuration needed in next.config.js
// Pages are statically generated by default
export default async function StaticPage() {
  const data = await fetchData();
  return <div>{data}</div>;
}
```

**üìã Next.js Config:** ‚úÖ **No configuration required** - Works out of the box

**Live Example:** `/products/static`

---

### 2. Server-Side Rendering (SSR) ‚≠ê

**Generated on each request - always fresh**

```typescript
// No special configuration needed in next.config.js
// Use dynamic functions to opt into SSR
import { headers } from "next/headers";

export default async function SSRPage() {
  const headersList = headers(); // Makes page dynamic
  const data = await fetchFreshData();
  return <div>{data}</div>;
}
```

**üìã Next.js Config:** ‚úÖ **No configuration required** - Automatic when using dynamic functions

**Live Example:** `/products/ssr`

---

### 3. Incremental Static Regeneration (ISR) ‚≠ê

**Static with smart revalidation - best of both worlds**

```typescript
// 30-second revalidation
export const revalidate = 30;

// 1-minute revalidation for better performance
export const revalidate = 60;

export default async function ISRPage() {
  const data = await fetchData();
  return <div>{data}</div>;
}
```

**üìã Next.js Config:** ‚úÖ **No configuration required** - Use `export const revalidate = seconds`

**Live Examples:**

- `/products/isr` - 30-second updates
- `/products/isr-1min` - 1-minute updates

---

### 4. Data Caching ‚≠ê

**Cache fetch requests and function results**

```typescript
import { cache } from "react";

// Cached function - prevents duplicate calls
const getCachedData = cache(async () => {
  return await expensiveApiCall();
});

export default async function DataCachePage() {
  const data = await getCachedData(); // Cached per request
  return <div>{data}</div>;
}
```

**üìã Next.js Config:** ‚úÖ **No configuration required** - Uses React's built-in cache

**Live Example:** `/products/datacache`

---

### 5. 'use cache' Directive ‚≠ê **NEW**

**Module-level caching for expensive operations**

```typescript
"use cache";

export async function getExpensiveData() {
  // This function result is cached across the module
  return await database.query(complexQuery);
}

export default async function UseCachePage() {
  const data = await getExpensiveData(); // Automatically cached!
  return <div>{data}</div>;
}
```

**üìã Next.js Config:** ‚öôÔ∏è **REQUIRED** - Must enable in next.config.js:

```javascript
module.exports = {
  experimental: {
    cacheComponents: true, // Enables 'use cache' directive
  },
};
```

**Live Examples:**

- `/products/use-cache` - Basic function caching
- `/products/use-cache-profile` - Advanced user profile caching

---

### 6. Partial Pre-rendering (PPR) ‚≠ê **EXPERIMENTAL**

**Static shell with dynamic streaming - the future**

```typescript
import { Suspense } from "react";

export default function PPRPage() {
  return (
    <div>
      {/* Static - prerendered at build time */}
      <Header />
      <ProductCatalog />

      {/* Dynamic - streamed on request */}
      <Suspense fallback={<UserSkeleton />}>
        <UserProfile />
      </Suspense>

      <Suspense fallback={<RecsSkeleton />}>
        <PersonalizedRecommendations />
      </Suspense>
    </div>
  );
}
```

**üìã Next.js Config:** ‚öôÔ∏è **REQUIRED** - Must enable in next.config.js:

```javascript
module.exports = {
  experimental: {
    cacheComponents: true, // Enables PPR (same flag as 'use cache')
  },
};
```

**Live Example:** `/products/ppr`

---

### 7. Client-Side Rendering (CSR) ‚≠ê

**Rendered in browser - highly interactive**

```typescript
"use client";

import { useState, useEffect } from "react";

export default function ClientPage() {
  const [data, setData] = useState(null);

  useEffect(() => {
    fetch("/api/data")
      .then((res) => res.json())
      .then(setData);
  }, []);

  return <div>{data ? data.content : "Loading..."}</div>;
}
```

**üìã Next.js Config:** ‚úÖ **No configuration required** - Use `'use client'` directive

**Live Example:** `/products/client`

---

## üìã **Configuration Summary Table**

| Strategy        | Next.js Config Required | Flag/Setting              | Performance | Use Case         |
| --------------- | ----------------------- | ------------------------- | ----------- | ---------------- |
| **SSG**         | ‚ùå None                 | Default behavior          | ‚ö°‚ö°‚ö°‚ö°‚ö°  | Static content   |
| **SSR**         | ‚ùå None                 | Dynamic functions         | ‚ö°‚ö°‚ö°      | Fresh data       |
| **ISR**         | ‚ùå None                 | `export const revalidate` | ‚ö°‚ö°‚ö°‚ö°    | Semi-dynamic     |
| **Data Cache**  | ‚ùå None                 | React cache()             | ‚ö°‚ö°‚ö°‚ö°    | Expensive ops    |
| **'use cache'** | ‚úÖ **YES**              | `cacheComponents: true`   | ‚ö°‚ö°‚ö°‚ö°‚ö°  | Function caching |
| **PPR**         | ‚úÖ **YES**              | `cacheComponents: true`   | ‚ö°‚ö°‚ö°‚ö°‚ö°  | Mixed content    |
| **CSR**         | ‚ùå None                 | `'use client'`            | ‚ö°‚ö°        | Interactive      |

---

## üîß **Complete next.config.js Template**

Copy this configuration to enable all caching features:

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    // Enable modern caching features
    cacheComponents: true, // Enables 'use cache' + PPR
  },

  // Performance optimizations
  devIndicators: {
    buildActivity: false,
    buildActivityPosition: "bottom-right",
  },

  // Image optimization (if using external images)
  images: {
    remotePatterns: [
      {
        protocol: "https",
        hostname: "fakestoreapi.com",
      },
      {
        protocol: "https",
        hostname: "via.placeholder.com",
      },
    ],
  },

  // Optional: Custom rewrites for API routes
  async rewrites() {
    return [
      {
        source: "/api/products/:id",
        destination: "/api/products/:id",
      },
    ];
  },
};

module.exports = nextConfig;
```

---

## üö® **Important Notes**

### **Configuration Dependencies:**

- **'use cache'** and **PPR** both require `experimental.cacheComponents: true`
- **SSG**, **SSR**, **ISR**, **Data Cache**, and **CSR** work without any config
- Always restart your dev server after changing `next.config.js`

### **Version Requirements:**

- **PPR**: Next.js 14+ (experimental)
- **'use cache'**: Next.js 14+ (experimental)
- **All others**: Next.js 12+

---

## üéÆ **Getting Started**

1. **Clone and install:**

   ```bash
   npm install
   ```

2. **Ensure proper configuration:**

   - Copy the complete `next.config.js` template above
   - Restart your dev server

3. **Start exploring:**

   ```bash
   npm run dev
   ```

4. **Visit examples:**
   - Basic caching: `/products/static`, `/products/isr`
   - Advanced caching: `/products/use-cache-profile`, `/products/ppr`

---

## üìö **Learning Resources**

- **Next.js Caching Docs**: [Next.js Data Fetching](https://nextjs.org/docs/app/building-your-application/data-fetching)
- **ISR Guide**: [Incremental Static Regeneration](https://nextjs.org/docs/app/building-your-application/data-fetching/incremental-static-regeneration)
- **PPR Guide**: [Partial Prerendering](https://nextjs.org/docs/app/api-reference/next-config-js/partial-prerendering)
- **Use Cache**: [Next.js 15 Caching](https://nextjs.org/docs/app/api-reference/directives/use-cache)

---

**üéØ Focus Areas for Learning:**

1. **Start with ISR** - `/products/isr` (most practical)
2. **Explore PPR** - `/products/ppr` (future-proof)
3. **Master 'use cache'** - `/products/use-cache-profile` (performance boost)

---

# üè∑Ô∏è **NEW: Cache Tags (Next.js 16)**

**Cache Tags** are the newest and most powerful caching feature in Next.js 16, providing selective cache invalidation with surgical precision.

### üöÄ **Interactive Demo: `/products/cache-tags`**

**What makes Cache Tags special:**

- ‚úÖ **Selective Invalidation** - Update only specific caches, not everything
- ‚úÖ **Multi-Tag Support** - One cache can belong to multiple tag groups
- ‚úÖ **Performance Gains** - No unnecessary cache rebuilds
- ‚úÖ **Real-World Ready** - Perfect for user data, inventory, content management

**Live demonstration:**

- üîµ **User Cache** - Tagged with `['users']`
- üü¢ **Product Cache** - Tagged with `['products']`
- üü£ **Shared Cache** - Tagged with `['users', 'products']` (responds to both!)

**Try it yourself:**

1. Visit `/products/cache-tags` and note the random data
2. Click "Revalidate 'users' Tag" ‚Üí Only user + shared caches update
3. Click "Revalidate 'products' Tag" ‚Üí Only product + shared caches update
4. Watch selective invalidation in real-time!

### Cache Tags Code Example:

```typescript
import { unstable_cache, revalidateTag } from "next/cache";

// User cache with 'users' tag
const getUserData = unstable_cache(
  async () => await fetchUser(),
  ["user-cache"],
  { tags: ["users"] }
);

// Product cache with 'products' tag
const getProductData = unstable_cache(
  async () => await fetchProducts(),
  ["product-cache"],
  { tags: ["products"] }
);

// Shared cache with BOTH tags
const getSharedData = unstable_cache(
  async () => await fetchSharedInfo(),
  ["shared-cache"],
  { tags: ["users", "products"] } // Updates with either tag!
);

// Selective revalidation
revalidateTag("users"); // Updates user + shared caches only
revalidateTag("products"); // Updates product + shared caches only
```

---

## üöÄ Features Demonstrated

### üåü **Latest Next.js 16 Features**

- **üè∑Ô∏è Cache Tags** - Selective cache invalidation (NEW!)

### Advanced Caching Features

- **'use cache' Directive** - Next.js 15+ automatic module-level caching
- **Partial Prerendering (PPR)** - Experimental static shell with dynamic streaming
- **Data Cache** - Function-level caching to prevent duplicate fetches

### Core Caching Strategies

- **Static Site Generation (SSG)** - Pre-built at build time for maximum performance
- **Server-Side Rendering (SSR)** - Generated on each request for always-fresh data
- **Incremental Static Regeneration (ISR)** - Static with periodic updates (30s and 60s intervals)
- **Client-Side Rendering (CSR)** - Browser-rendered for interactive experiences

## Cache Tags Best Practices (Next.js 16)

### Recommended Patterns:

- **User-specific data**: `tags: ['users']`
- **Product catalog**: `tags: ['products', 'catalog']`
- **Shopping cart**: `tags: ['users', 'products']` (multi-tag)
- **Inventory management**: `tags: ['inventory', 'products']`

### When to Use Cache Tags:

- E-commerce sites - User profiles vs product data vs inventory
- Content platforms - Articles vs comments vs user data
- Dashboards - Different widgets with different update cycles
- Multi-tenant apps - Tenant-specific vs shared data

### Cache Tags Tips:

- Use descriptive tag names (`users`, `products`, not `cache1`, `cache2`)
- Group related caches with common tags for batch updates
- Combine tags for shared dependencies (shopping cart needs both user + product data)
- Test selective invalidation in development to ensure it works as expected

### Performance Benefits:

- Reduced server load - Only regenerate what changed
- Faster updates - No need to rebuild entire cache
- Better user experience - Targeted updates feel more responsive
- Scalable architecture - Cache grows intelligently with your app

---

## Start Your Journey

**New to Next.js caching?** Start with the basics:

1. **Static Generation** (`/products/static`) - Understanding the foundation
2. **ISR** (`/products/isr`) - Adding dynamic updates
3. **Cache Tags** (`/products/cache-tags`) - Master the newest, most powerful feature

**Cache Tags represent the evolution of caching in Next.js 16** - giving developers unprecedented control over cache invalidation with surgical precision.

## Learn More

- [Next.js Caching Documentation](https://nextjs.org/docs/app/building-your-application/caching)
- [unstable_cache API](https://nextjs.org/docs/app/api-reference/functions/unstable_cache)
- [Cache Tags Guide](https://nextjs.org/docs/app/building-your-application/caching#cache-tags) (Next.js 16+)
- [Incremental Static Regeneration](https://nextjs.org/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating#revalidating-data)
